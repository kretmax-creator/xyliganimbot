# Vision

## 1. Введение и принципы

Данный документ описывает техническое видение проекта **xyliganimbot** и служит отправной точкой для разработки минимально жизнеспособного решения (MVP).

Проект является pet-project’ом и предназначен для проверки идеи использования Telegram-бота в рабочем чате как простого интерфейса к небольшой базе знаний.

### Ключевые принципы

- **KISS** — максимальная простота во всех решениях
- **MVP-first** — реализуется только необходимый минимум
- **Файловое хранилище** — без БД на первом этапе
- **Допустима потеря состояния** при перезапуске
- **Один чат, ограниченное число пользователей**
- **Без преждевременной оптимизации**
- **LLM — опционально**, подключается только при явной пользе

---

## 2. Технологии

### Язык разработки

- Основной язык: **Python**
- Причины выбора:
  - минимальный порог входа;
  - богатая экосистема для Telegram-ботов;
  - скорость реализации MVP.

Архитектура проектируется так, чтобы в будущем была возможна миграция на Go или Node.js без концептуальных изменений.

### Telegram API

- Используется **Telegram Bot API**
- Режим работы: **polling**
- Webhook не используется в MVP

---

## 3. Принципы разработки

- Простая и читаемая кодовая база
- Минимум зависимостей
- Явное поведение без «магии»
- Ошибки обрабатываются централизованно
- Документация:
  - `README.md`
  - комментарии по месту в коде

---

## 4. Архитектура проекта

### Общий подход

- Монолитное приложение
- Модульная структура
- Один процесс
- Один экземпляр бота

### Основные компоненты

- Telegram-адаптер
- Модуль поиска по базе знаний
- Модуль команд
- Конфигурация
- Логирование

Архитектура не предполагает:
- микросервисов;
- очередей;
- фоновых воркеров.

---

## 5. Структура проекта

Проект состоит из нескольких каталогов с логическим разделением ответственности.

Примерная структура:

- `cmd/` или `main.py` — точка входа
- `bot/` — работа с Telegram API
- `handlers/` — обработка команд и сообщений
- `knowledge/` — загрузка и поиск по базе знаний
- `config/` — работа с конфигурацией
- `logs/` — логика логгирования
- `data/` — файлы базы знаний
- `scripts/` — утилиты (импорт из Google Docs)

---

## 6. Модель данных

### Основные сущности

- **База знаний**
- **Пользователи**
- **Логи**

### Пользователи

- Пользователь считается авторизованным, если он состоит в разрешённом Telegram-чате
- Дополнительно поддерживается список администраторов (`user_id`) в конфигурации

### Хранение данных

- Все данные хранятся в файлах
- База знаний — в формате Markdown
- Состояние в памяти не сохраняется между перезапусками

---

## 7. Работа с базой знаний и LLM

### Поиск

Используется комбинация подходов:
- простой текстовый поиск;
- поиск по заголовкам и разделам.

Результат поиска:
- краткий ответ;
- ссылка или указание на конкретный раздел базы знаний.

### LLM

- Использование LLM **опционально**
- Не является частью MVP
- Возможные сценарии:
  - «причесывание» ответа;
  - улучшение релевантности поиска в будущем.

LLM не участвует в принятии решений и не хранит состояние.

---

## 8. Работа с Google Docs

### Цель интеграции

Google Docs используется:
- как источник базы знаний;
- как редактор контента для нетехнических пользователей.

### Модель взаимодействия

- Односторонняя модель: **Google Docs → бот**
- Бот работает только с локальными файлами
- Google Docs не используется в runtime

### Обновление данных

Поддерживаются:
- ручной импорт;
- периодический импорт (например, раз в неделю).

### Формат

- Один Google Doc → один Markdown-файл
- Структура документа сохраняется

### Ограничения

Сознательно не реализуются:
- двусторонняя синхронизация;
- realtime-обновления;
- webhooks;
- UI управления импортом.

---

## 9. Сценарии работы

### Пользовательские сценарии

#### Поиск ответа

1. Пользователь задаёт вопрос в чате
2. Бот выполняет поиск по базе знаний
3. Если информация найдена:
   - ответ отправляется **reply**;
   - возвращается краткий ответ + ссылка/указание на раздел
4. Если ничего не найдено:
   - бот сообщает об этом;
   - предлагает переформулировать запрос

#### Помощь

- Команда `/help`
- Отправляется отдельным сообщением

### Административные сценарии

#### Статус

- Команда `/status`
- Показывает, что бот работает

#### Перезагрузка базы знаний

- Команда `/reload`
- Перечитывает файлы базы знаний
- Доступна только администраторам

### Ошибки

- Короткие нейтральные сообщения пользователю
- Технические детали не раскрываются
- Ошибки логируются

### Неподдерживаемые сценарии

Бот:
- не ведёт диалог;
- не запоминает контекст;
- не отвечает в личных сообщениях.

---

## 10. Деплой

### Общий подход

- Docker-контейнер
- Один контейнер = один бот

### Kubernetes

- Используется существующий кластер
- Простой `Deployment` с одной репликой
- Не используются:
  - autoscaling;
  - сервисы балансировки;
  - sidecar-контейнеры.

### Обновление

- Ручное:
  - сборка нового образа;
  - перезапуск Pod’а.
- Zero-downtime не требуется

### Ограничения

- Без CI/CD
- Без дополнительных health-check сервисов

---

## 11. Подход к конфигурированию

### Источники

- `config.yaml` — основной источник
- Переменные окружения — только для секретов

Приоритет:
1. env;
2. `config.yaml`.

### Обязательные параметры

- Telegram Bot Token
- ID разрешённого чата
- список admin `user_id`
- путь к базе знаний
- уровень логирования

### Ошибки конфигурации

- Бот не стартует
- Ошибка явно логируется
- Нет значений по умолчанию для критичных параметров

### Применение изменений

- Только через рестарт
- Hot-reload не поддерживается

---

## 12. Подход к логгированию

### Инструмент

- Стандартный `logging` из Python
- Без внешних логгеров

### Уровни

- `INFO`
- `ERROR`
- `DEBUG` (по необходимости)

### Что логируется

- запуск и остановка;
- команды;
- ошибки.

Тексты пользовательских сообщений:
- отключены по умолчанию;
- включаются отдельной настройкой.

### Назначение логов

- `stdout` / `stderr`
- Без файловых логов внутри контейнера

### Ограничения

- Без distributed tracing
- Без correlation ID
- Без избыточного логирования персональных данных
