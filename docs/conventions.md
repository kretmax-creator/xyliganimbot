---
alwaysApply: true
---

# Conventions (read alongside `docs/vision.md`)


# Cursor — единые обязательные правила разработки (Python)

## 1. Режим работы и контроль шагов

1. Строгий пошаговый процесс  
Любая задача выполняется по шагам.  
Переход к следующему шагу — только после явного подтверждения пользователя.

2. Без подтверждения — стоп  
Если подтверждение не получено:
- напомни о необходимости подтверждения,
- затем остановись и не выполняй дальнейших действий.

3. Один шаг — одна фаза  
За один шаг разрешён только один тип работы:
- анализ,
- предложение решения,
- реализация кода,
- ревью.  
Смешивание фаз без подтверждения запрещено.

4. Фиксация состояния  
После каждого шага явно фиксируй:
- текущее состояние задачи,
- принятые решения,
- предлагаемый следующий шаг.

5. Неясно — спрашивай  
Если данных недостаточно или требования неоднозначны — не додумывай,  
задай минимальные уточняющие вопросы и жди ответа.

---

## 2. Технологические и языковые ограничения

6. Python only  
- Весь код пишется исключительно на Python (>= 3.10).
- Запрещено предлагать примеры, фрагменты или альтернативы на других языках.

7. Минимализм и KISS  
- Маленькие, понятные инкременты.
- Никакого оверинжиниринга.
- Предпочтение простым функциям, классы — только при реальной необходимости.

---

## 3. Архитектура и структура проекта

8. Следование утверждённой архитектуре  
- Следуй структуре и принципам, описанным в docs/vision.md.
- Не вводи новые слои, сервисы или паттерны без явного согласования.

9. Базовая архитектура  
- Telegram-адаптер → доменная логика → доступ к данным.
- Адаптер не обращается к данным напрямую.
- Один процесс / один контейнер по умолчанию.

10. Структура проекта  
- Код: src/  
- Данные (JSON): data/  
- Документация и ADR: docs/  
- Конфиги: config.yaml / config.toml  
- Секреты: только через ENV  
- Логи: logs/app.log, logs/audit.log

---

## 4. Стандарты кода и качества

11. Стандарты обязательны  
- PEP8  
- Совместимость с black  
- type hints  
- docstrings только для публичных API

12. Приоритеты качества  
читаемость → предсказуемость → простота → оптимизация

13. Один файл — одна ответственность  
Каждый модуль решает одну чёткую задачу.

14. Понятные имена  
Имена функций и переменных должны быть самодокументируемыми.

---

## 5. Перед написанием и изменением кода

15. Перед реализацией  
Перед написанием кода необходимо:
- описать решение на высоком уровне,
- перечислить затрагиваемые файлы и модули,
- запросить подтверждение на реализацию.

16. Изменение существующего кода  
Перед изменениями:
- чётко описать, что именно меняется,
- указать риски,
- предложить минимальный diff.  
Без подтверждения изменения запрещены.

---

## 6. Ошибки и логирование

17. Обработка ошибок  
- Простые try/except.
- Логируй ошибку, возвращай понятное сообщение.
- Никаких сложных retry и автоматических повторов в MVP.

18. Логирование  
- Используй только стандартный logging.
- Формат: время, модуль, уровень, сообщение.
- Логируй:
  - входящие сообщения,
  - ответы пользователям,
  - операции с данными,
  - ошибки.

---

## 7. После реализации

19. Self-review обязателен  
После каждого изменения:
- что изменилось,
- что сознательно не трогалось,
- что нужно проверить вручную.

20. Команды для запуска  
Если применимо — подготовь команды:
- сборка,
- запуск,
- остановка,
- базовая диагностика.

---

## 8. Документы и ревью

21. Ревью по умолчанию  
При работе с документами (requirements, design, PRD, README):
- сначала только ревью,
- без переписывания и правок.

22. Структура ревью  
- краткое резюме,
- неясности и пробелы,
- вопросы,
- сильные стороны,
- рекомендации (без правок).

23. Разделение ревью и правок  
- Анализ и правки — разные шаги.
- Любые правки — только после подтверждения.

---

## 9. Запреты

24. Запрещено:
- внешние БД (PostgreSQL, Redis и т.д.),
- микросервисы и сложная архитектура,
- async/await без крайней необходимости,
- сложные конфиги,
- избыточные абстракции и классы,
- хардкод секретов,
- бизнес-логика в Telegram-адаптере,
- изменение форматов данных без согласования (ADR),
- коммиты до подтверждения завершения итерации.

