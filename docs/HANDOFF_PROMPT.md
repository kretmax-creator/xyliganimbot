# Промпт для передачи работ другому агенту

## Контекст проекта

Ты продолжаешь разработку проекта **xyliganimbot** — Telegram-бота для поиска ответов в базе знаний (документ Google Docs).

**Цель проекта**: Поиск ответов в базе знаний через Telegram-бота.

**Рабочая папка**: `c:\VirtualBox\shared\xyliganimbot\`

## Ключевые документы

Обязательно изучи перед началом работы:

1. **`docs/idea.md`** — описание идеи проекта, функциональные и нефункциональные требования
2. **`docs/vision.md`** — техническое видение проекта (технологии, архитектура, модель данных, сценарии работы)
3. **`docs/tasklist_v0.1.md`** — план разработки с итерациями и задачами (отмечай выполненные задачи чекбоксами)
4. **`docs/BACKLOG.md`** — бэклог задач с приоритетами
5. **`docs/TESTING.md`** — план тестирования и критерии готовности

## Принципы разработки

**КРИТИЧЕСКИ ВАЖНО** — следуй принципам KISS (Keep It Simple, Stupid):

- **KISS** — максимально простое решение без лишних абстракций
- **MVP-first** — реализуется только необходимый минимум
- **Файловое хранилище** — без БД на первом этапе, все данные в файлах (Markdown, JSON)
- **Допустима потеря состояния** — при перезапуске состояние не сохраняется, бот работает stateless
- **Один чат, ограниченное число пользователей**
- **Без преждевременной оптимизации**
- **LLM — опционально** — не является частью MVP
- **Ручное тестирование** — основной метод для MVP, автоматические тесты на первом этапе не требуются

## Текущее состояние проекта

### Структура проекта

```
xyliganimbot/
├── src/              # Исходный код бота
│   ├── __init__.py
│   ├── __main__.py
│   ├── bot.py        # Основной модуль бота
│   ├── config.py     # Работа с конфигурацией
│   ├── google_docs.py # Импорт документа из Google Docs
│   ├── logging.py    # Логирование
│   └── handlers/      # Обработчики команд и сообщений
│       └── __init__.py
├── data/             # Данные и кэш
│   ├── .gitkeep
│   ├── knowledge.html # Импортированный документ
│   ├── sections.json  # Заголовки разделов (23 заголовка)
│   └── images/        # Изображения из документа (45 изображений)
├── logs/             # Логи приложения
│   └── .gitkeep
├── docs/             # Документация
├── requirements.txt  # Зависимости Python
├── config.yaml       # Конфигурация
├── config.yaml.example
├── .gitignore
└── .env.example
```

### Что уже сделано

**Итерация 1: Настройка проекта и окружения** ✅
- Создана базовая структура папок
- Настроено Python окружение (requirements.txt)
- Созданы базовые файлы: README.md, .env.example, .gitignore
- Настроено форматирование кода (pyproject.toml с black)
- Создан config.yaml.example
- Настроено базовое логирование (src/logging.py)

**Итерация 2: Базовая интеграция с Telegram** ✅
- Установлена библиотека python-telegram-bot
- Создан модуль src/bot.py с базовой инициализацией
- Реализован long polling
- Создан базовый обработчик сообщений
- Реализована проверка белого списка пользователей/чатов
- Добавлена обработка ошибок подключения к Telegram API

**Итерация 3: Модуль работы с конфигурацией** ✅
- Создан модуль src/config.py
- Реализована загрузка config.yaml
- Реализована загрузка переменных окружения
- Добавлена валидация обязательных параметров
- Реализована загрузка белых списков
- Добавлена обработка ошибок конфигурации

**Итерация 4: Импорт документа из Google Docs** ✅
- Создан модуль src/google_docs.py
- Реализовано получение ZIP-архива с HTML и изображениями
- Реализована распаковка ZIP-архива
- Извлечение HTML-файла и сохранение в data/knowledge.html
- Извлечение изображений в папку data/images/
- Обновление ссылок на изображения в HTML на локальные пути
- Обработка ошибок и логирование операций
- Создан файл data/sections.json с заголовками разделов (23 заголовка)

### Что нужно сделать

Следуй плану в **`docs/tasklist_v0.1.md`**. Следующая итерация — **Итерация 5**: Обработка изображений и улучшение импорта.

## Инструкции по работе

### 1. Работа с планом задач

- Открывай `docs/tasklist_v0.1.md`
- Отмечай выполненные задачи чекбоксами: `- [ ]` → `- [x]`
- Работай последовательно по итерациям
- После завершения итерации переходи к следующей только после подтверждения

### 2. Структура кода

Следуй структуре из `vision.md`:
- `src/bot.py` — основной модуль бота
- `src/config.py` — работа с конфигурацией
- `src/google_docs.py` — работа с Google Docs
- `src/search.py` — логика поиска
- `src/logging.py` — логирование
- `src/audit.py` — аудит
- `src/handlers/` — обработчики команд и сообщений

### 3. Технологии

- **Python 3.x** с минимальными зависимостями
- **python-telegram-bot** (версия >=20.0) для Telegram API
- **google-api-python-client** для работы с Google Docs API (опционально, пока не используется)
- **pyyaml** для конфигурации
- **python-dotenv** для переменных окружения
- **html2text** для конвертации HTML в Markdown (опционально, пока не используется)

### 4. Конфигурация

- Основная конфигурация в `config.yaml` (создай `config.yaml.example`)
- Секреты через переменные окружения (`.env`)
- Белые списки пользователей/чатов в конфигурации

### 5. Логирование

- Стандартный Python `logging`
- Файл `logs/app.log` для продакшена
- Файл `logs/audit.log` для журнала действий
- Ротация логов по размеру файла
- Тексты пользовательских сообщений отключены по умолчанию

### 6. Обработка ошибок

- Простые try/except блоки
- Понятные сообщения пользователю (без технических деталей)
- Логирование всех ошибок
- Fallback на кэш при недоступности Google Docs

## Важные замечания

1. **Не оверинжинирь** — простое решение важнее идеального
2. **Работай итеративно** — одна итерация = один день работы
3. **Тестируй вручную** — автоматические тесты не требуются на первом этапе
4. **Документируй код** — комментарии по месту, README с инструкциями
5. **Следуй vision.md** — все технические решения должны соответствовать техническому видению

## Критерии готовности задачи

Задача считается выполненной, если:
- Код написан и работает
- Соответствует принципам KISS
- Соответствует структуре из vision.md
- Логирование работает
- Ошибки обрабатываются
- Задача отмечена в tasklist_v0.1.md

## Вопросы и уточнения

Если что-то непонятно:
1. Изучи `docs/vision.md` — там описаны все технические решения
2. Изучи `docs/idea.md` — там описаны требования
3. Следуй принципам KISS — выбирай самое простое решение

## Начало работы

1. Открой `docs/tasklist_v0.1.md`
2. Найди первую невыполненную задачу в **Итерации 5**
3. Изучи выполненные итерации 1-4 для понимания текущей архитектуры
4. Начни выполнение
5. Отмечай прогресс чекбоксами

## Важные изменения в архитектуре

- **Импорт документа**: используется ZIP-архив с HTML и изображениями (export?format=zip)
- **Хранение изображений**: изображения сохраняются локально в `data/images/` для отправки пользователям
- **Заголовки разделов**: хранятся в `data/sections.json` и управляются вручную администратором
- **Формат документа**: документ сохраняется в HTML (`data/knowledge.html`), не в Markdown

**Удачи!**
