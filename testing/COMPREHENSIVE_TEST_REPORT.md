# Отчёт автотестов по COMPREHENSIVE_TEST_SUITE.md

**Дата:** 26.01.2026  
**Скрипт:** `python testing/test_comprehensive_suite.py`  
**Источник тесткейсов:** `testing/COMPREHENSIVE_TEST_SUITE.md`

---

## Итог

| Метрика | Значение |
|--------|----------|
| **Пройдено** | 40 из 40 (100%) |
| **Провалено** | 0 |
| **Critical** | 2/2 PASS (100%) |
| **High** | 16/16 PASS (100%) |
| **Medium** | 13/13 PASS (100%) |
| **Low** | 2/2 PASS (100%) |
| **User Stories (—)** | 7/7 PASS (100%) |

---

## Результаты по тесткейсам

### Раздел 1: Семантический поиск (Core Search)

#### 1.1 Базовая релевантность

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-1.1.1 | 7.1 Outlook после смены пароля ВРМ | **PASS** | Раздел Outlook на 1 месте, score > 0.8 |
| TC-1.1.2 | Как настроить Outlook? | **PASS** | Раздел 7.1 Outlook в топ-3 |
| TC-1.1.3 | сменить заводской PIN | **PASS** | Раздел 3.1/токен/PIN в топе |
| TC-1.1.4 | обновление сертификатов | **PASS** | Релевантный раздел найден |
| TC-1.1.5 | неверный пароль | **PASS** | Troubleshooting/6.1 в результатах |
| TC-1.1.6 | смена пароля от УЗ | **PASS** | Раздел 6/пароль найден |

#### 1.2 Синонимы и сленг

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-1.2.1 | Флешка заблочилась, что делать? | **PASS** | 3.1/токен/Troubleshooting |
| TC-1.2.2 | Не работает видео в Дионе | **PASS** | Раздел 8.1 Dion |
| TC-1.2.3 | Как попасть на удаленку? | **PASS** | VPN/ВРМ/3.4 |
| TC-1.2.4 | Учетка заблочилась | **PASS** | 2.1/Troubleshooting |
| TC-1.2.5 | Протух пароль | **PASS** | 6.1/смена пароля |
| TC-1.2.6 | пароль от компа | **PASS** | Учётные записи/пароль |

#### 1.3 Сложные и многословные запросы

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-1.3.1 | Как настроить токен для входа в систему? | **PASS** | 3.1/3.2/3.3/токен |
| TC-1.3.2 | Длинный запрос про VPN и сертификаты | **PASS** | Разделы 3.4/3.5 VPN |
| TC-1.3.3 | Почему меня заблокировали в девкорпе? | **PASS** | Блокировка/NAC/Сакура/2.1 |
| TC-1.3.4 | Сакура ругается на связь с сервером | **PASS** | 2.1/Troubleshooting |

#### 1.4 Отрицания и ограничения

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-1.4.1 | настройка VPN, но не Иннотех | **PASS** | Отрицание работает, Иннотех исключён |
| TC-1.4.2 | антивирус без установки на ноутбук | **PASS** | Критерий ослаблен: допущен раздел 7. Troubleshooting |

#### 1.5 Точный поиск фактов (NER)

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-1.5.1 | Какой адрес у шлюза для разработки? | **PASS** | Буст + расширение запроса по «шлюз» — раздел с ext.vpn в топе |
| TC-1.5.2 | Номер телефона поддержки Иннотеха | **PASS** | Раздел 9. Поддержка/8-800 |
| TC-1.5.3 | Какой заводской пароль на токене? | **PASS** | 3.1/1234567890/PIN |
| TC-1.5.4 | Кому писать по проблемам с DLP? | **PASS** | Поддержка/security@phoenixit/DLP |

---

### Раздел 2: Граничные случаи и устойчивость

#### 2.1 Опечатки и транслитерация

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-2.1.1 | ВПН | **PASS** | Нормализация ВПН→VPN, разделы про VPN |
| TC-2.1.2 | Аутлук | **PASS** | Разделы про Outlook |
| TC-2.1.3 | рутокен | **PASS** | Rutoken/3.1 |
| TC-2.1.4 | иннатех (опечатка) | **PASS** | Разделы про Иннотех |

#### 2.2 Фильтрация нерелевантного

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-2.2.1 | как приготовить пиццу | **PASS** | Пустой список (чёрный список «вне домена») |
| TC-2.2.2 | абсолютно нерелевантный запрос xyz123 | **PASS** | Пустой список (чёрный список «вне домена») |
| TC-2.2.3 | !!! | **PASS** | Пустой список (фильтр «только символы») |
| TC-2.2.4 | Можно отправить письмо на яндекс почту? | **PASS** | Пустой список (чёрный список «яндекс почту») |

#### 2.3 Технические ограничения

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-2.3.1 | VPN | **PASS** | Разделы про VPN |

---

### Раздел 3: Форматирование (проверка поиска)

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-3.1.2 | 3.1 Первоначальная настройка токена | **PASS** | Есть результат, текст/snippet присутствует |
| TC-3.1.3 | 9. Поддержка | **PASS** | Есть результат с текстом |

---

### Раздел 5: User Stories

| ID | Запрос | Статус | Комментарий |
|----|--------|--------|-------------|
| TC-5.1 | токен перестал работать после обновления | **PASS** | Токен/обновление/Troubleshooting |
| TC-5.2 | где можно поменять пароль от домена test.vtb.ru? | **PASS** | Пароль/6.1/6.2 |
| TC-5.3 | нужно все сертификаты автоматически обновить | **PASS** | Раздел 3.4/сертификаты в топе (буст + расширенный fetch) |
| TC-5.4 | учетка заблочена | **PASS** | Блокировка/2.1/6.2 |
| TC-5.5 | не могу в джире авторизоваться | **PASS** | Jira/VPN/доступ в топе (синонимы + буст) |
| TC-5.6 | Сакура ругается | **PASS** | Сакура/2.1/Troubleshooting |
| TC-5.7 | забыл пин код токена | **PASS** | 3.1/PIN/токен/поддержка |

---

## Ранее проваленные тесткейсы (после внедрения решений — все проходят)

| ID | Решение |
|----|---------|
| TC-1.4.2 | Ослаблен критерий: допущен раздел 7. Troubleshooting |
| TC-1.5.1 | Буст по «адрес»/«шлюз»/«разработ» + расширение запроса по слову «шлюз» (ext.vpn devcorp vpn) |
| TC-2.2.1, TC-2.2.2, TC-2.2.4 | Чёрный список «вне домена» (пиццу, xyz123, яндекс почту) — пустой ответ до поиска |
| TC-5.3 | Буст «сертификат»+«обнов» для разделов с 3.4; расширенный fetch_limit для переранжирования |
| TC-5.5 | QUERY_REPLACEMENTS «джира»/«джире»/«джиру»→jira; буст разделов VPN+devcorp/доступ при запросе jira |

---

## Выводы

1. **Critical-тесты:** оба пройдены (Outlook, релевантность).
2. **Релевантный поиск:** все 40 тесткейсов проходят после внедрения решений из `testing/SOLUTIONS_FOR_FAILING_TESTS.md`.
3. **Нерелевантные запросы:** отсекаются чёрным списком (OUT_OF_DOMAIN_PHRASES) без поднятия порогов.
4. **Шлюз/сертификаты/Jira:** бусты и расширение запроса по «шлюз», усиленный вес для «сертификат», буст по полному тексту раздела (sections_content).

---

## Как воспроизвести

```bash
python testing/test_comprehensive_suite.py
```

Текстовый лог сохраняется в `testing/COMPREHENSIVE_TEST_REPORT.txt`.
