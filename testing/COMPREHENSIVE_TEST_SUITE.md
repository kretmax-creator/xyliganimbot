# Полный набор тесткейсов xyliganimbot

Этот документ содержит исчерпывающий список тесткейсов для тестирования Telegram-бота `xyliganimbot`. Набор составлен на основе:
- Технического видения (`docs/vision.md`)
- Плана тестирования (`testing/TEST_PLAN.md`)
- Результатов ручного тестирования (`testing/MANUAL_TEST_RESULTS_E5.md`)
- Анализа качества (`testing/QA_ANALYSIS_E5.md`)
- Реальных запросов пользователей (`docs/knowledge_base_queries.md`)

Тесткейсы предназначены как для **ручного**, так и для **автоматизированного** тестирования.

## Структура тесткейса

| Поле | Описание |
|---|---|
| **ID** | Уникальный идентификатор (например, `TC-1.1.1`) |
| **Категория** | Группа тестов (Семантика, Форматирование, Ошибки и т.д.) |
| **Запрос** | Текст сообщения, отправляемого боту |
| **Ожидаемый результат** | Критерии успешного прохождения (найденный раздел, сообщение, поведение) |
| **Приоритет** | `Critical` (блокирует релиз), `High`, `Medium`, `Low` |
| **Тип** | `Auto` (можно автоматизировать), `Manual` (требует человека), `Hybrid` |
| **Источник** | Откуда взят кейс (Plan, RealLog, Analysis) |

---

## Раздел 1: Семантический поиск (Core Search)

Проверка способности системы находить релевантную информацию по смыслу.

### 1.1 Базовая релевантность (Direct Relevance)

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-1.1.1** | `7.1 Outlook после смены пароля ВРМ` | 1. Найден раздел "7.1 Outlook после смены пароля ВРМ". <br> 2. Позиция: #1. <br> 3. Score > 0.8. | Critical | Auto | Plan |
| **TC-1.1.2** | `Как настроить Outlook?` | 1. Найден раздел "7.1 Outlook...". <br> 2. Позиция: Топ-3. | Critical | Auto | Plan |
| **TC-1.1.3** | `сменить заводской PIN` | 1. Найден раздел "3.1 Первоначальная настройка токена". <br> 2. Текст содержит "1234567890" или упоминание PIN. | High | Auto | Analysis |
| **TC-1.1.4** | `обновление сертификатов` | 1. Найден раздел про обновление сертификатов или "3.4 Настройка VPN". | High | Auto | RealLog |
| **TC-1.1.5** | `неверный пароль` | 1. Найден раздел "7. Troubleshooting" или "6.1 Смена и проверка паролей". | High | Auto | RealLog |
| **TC-1.1.6** | `смена пароля от УЗ` | 1. Найден раздел "6. Управление учетными записями" или подраздел про смену пароля. | High | Auto | RealLog |

### 1.2 Синонимы и сленг (Paraphrasing & Slang)

Проверка понимания неформальной лексики из реальных чатов.

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-1.2.1** | `Флешка заблочилась, что делать?` | 1. Найден раздел "3.1 Первоначальная настройка токена" или Troubleshooting. <br> 2. Система понимает "Флешка" == "Токен". | High | Auto | RealLog |
| **TC-1.2.2** | `Не работает видео в Дионе` | 1. Найден раздел "8.1 Сетевые исключения (Dion)". | Medium | Auto | RealLog |
| **TC-1.2.3** | `Как попасть на удаленку?` | 1. Найден раздел про ВРМ/VPN ("1.1 Контур Region", "3.4 Настройка VPN"). <br> 2. Система понимает "Удаленка" == "ВРМ/VPN". | High | Auto | RealLog |
| **TC-1.2.4** | `Учетка заблочилась` | 1. Найден раздел "2.1 Обязательное ПО" (автоматическая блокировка) или Troubleshooting. | High | Auto | RealLog |
| **TC-1.2.5** | `Протух пароль` | 1. Найден раздел "6.1 Смена и проверка паролей". <br> 2. Система понимает "Протух" == "Истек срок действия". | Medium | Auto | RealLog |
| **TC-1.2.6** | `пароль от компа` | 1. Найден раздел про учетные записи Windows/ВРМ. | Medium | Auto | RealLog |

### 1.3 Сложные и многословные запросы (Contextual)

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-1.3.1** | `Как настроить токен для входа в систему?` | 1. Найдены разделы 3.1 (Токен) и возможно 3.2/3.3. | Medium | Auto | Plan |
| **TC-1.3.2** | `Мне нужно настроить VPN подключение для доступа к внутренним ресурсам банка, но я не знаю какой сертификат выбрать и какой адрес сервера использовать` | 1. Найдены разделы про настройку VPN (3.4, 3.5). <br> 2. Score не падает из-за длины. | Medium | Auto | Plan |
| **TC-1.3.3** | `Почему меня заблокировали в девкорпе?` | 1. Найден раздел с причинами блокировки (NAC Сакура, 2.1). | Medium | Auto | Analysis |
| **TC-1.3.4** | `Сакура ругается на связь с сервером` | 1. Найден раздел "2.1 Обязательное ПО" или Troubleshooting. | Medium | Auto | Analysis |

### 1.4 Отрицания и ограничения (Negation)

*Примечание: Текущие модели могут плохо поддерживать отрицания, тесты для мониторинга улучшений.*

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-1.4.1** | `настройка VPN, но не Иннотех` | 1. В топе результатов разделы про VPN ВТБ (Region/DevCorp). <br> 2. Раздел "VPN ГК Иннотех" ниже или отсутствует. | Low (Future) | Auto | Analysis |
| **TC-1.4.2** | `антивирус без установки на ноутбук` | 1. Найден раздел, поясняющий правила установки ПО. | Low | Auto | Plan |

### 1.5 Точный поиск фактов (NER - Entities)

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-1.5.1** | `Какой адрес у шлюза для разработки?` | 1. Найден раздел содержащий `ext.vpn.vtb.ru`. | High | Auto | Analysis |
| **TC-1.5.2** | `Номер телефона поддержки Иннотеха` | 1. Найден раздел "9. Поддержка" с номером 8-800... | High | Auto | Analysis |
| **TC-1.5.3** | `Какой заводской пароль на токене?` | 1. Найден раздел "3.1" с текстом `1234567890`. | High | Auto | Analysis |
| **TC-1.5.4** | `Кому писать по проблемам с DLP?` | 1. Найден раздел с email `security@phoenixit.ru` или поддержкой. | Medium | Auto | Analysis |

---

## Раздел 2: Граничные случаи и устойчивость (Robustness)

### 2.1 Опечатки и транслитерация

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-2.1.1** | `ВПН` | 1. Найдены разделы про VPN. <br> 2. Работает нормализация `ВПН` -> `VPN`. | High | Auto | Analysis |
| **TC-2.1.2** | `Аутлук` | 1. Найдены разделы про Outlook. | High | Auto | RealLog |
| **TC-2.1.3** | `рутокен` | 1. Найдены разделы про Rutoken (3.1). | High | Auto | RealLog |
| **TC-2.1.4** | `иннатех` (опечатка) | 1. Найдены разделы про Иннотех (4.3, 6.2). | Medium | Auto | Analysis |

### 2.2 Фильтрация нерелевантного (Negative Testing)

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-2.2.1** | `как приготовить пиццу` | 1. Пустой список результатов ИЛИ сообщение "Ничего не найдено". <br> 2. Score < порога отсечения. | High | Auto | Analysis |
| **TC-2.2.2** | `абсолютно нерелевантный запрос xyz123` | 1. Пустой список результатов. | High | Auto | Analysis |
| **TC-2.2.3** | `!!!` (только символы) | 1. Пустой список или сообщение об ошибке формата. | Medium | Auto | Analysis |
| **TC-2.2.4** | `Можно отправить письмо на яндекс почту?` | 1. Если запрета нет в базе -> Пустой список (или релевантный раздел безопасности, если он есть). <br> 2. Не должно выдавать случайные разделы с высоким score. | Medium | Auto | Analysis |

### 2.3 Технические ограничения

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-2.3.1** | `VPN` (короткий) | 1. Найдены разделы про VPN. | High | Auto | Plan |
| **TC-2.3.2** | *(Пустое сообщение)* | 1. Игнорирование или просьба ввести текст. | Low | Manual | Plan |

---

## Раздел 3: Ответы бота и Форматирование (UX)

### 3.1 Форматирование сообщений

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-3.1.1** | Любой успешный запрос (напр. `VPN`) | 1. Заголовки выделены жирным (`<b>`). <br> 2. Текст читаем. <br> 3. Присутствует Score (релевантность). | High | Hybrid | Plan |
| **TC-3.1.2** | Запрос возвращающий длинный раздел (>500 симв) | 1. Текст обрезан (snippet). <br> 2. В конце стоит `...`. | Medium | Auto | Plan |
| **TC-3.1.3** | Запрос возвращающий короткий раздел (<500 симв) | 1. Показан полный текст раздела. | Medium | Auto | Plan |
| **TC-3.1.4** | Запрос с множеством результатов (>4096 симв суммарно) | 1. Ответ разбит на несколько сообщений. <br> 2. HTML-теги не разорваны. | High | Auto | Plan |

### 3.2 Отображение уверенности

| ID | Запрос | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-3.2.1** | Запрос с низким score (0.25 - 0.3) | 1. Рядом со score отображается предупреждение `⚠️ (низкая уверенность)`. | Medium | Auto | Plan |
| **TC-3.2.2** | Запрос с высоким score (> 0.5) | 1. Предупреждение отсутствует. | Medium | Auto | Plan |

---

## Раздел 4: Обработка ошибок и Администрирование

### 4.1 Отсутствие компонентов (System Integrity)

| ID | Действие | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-4.1.1** | Запрос при удаленном `data/knowledge.md` | Сообщение: "Документ базы знаний не найден. Обратитесь к администратору". Лог ошибки. | Critical | Manual | Plan |
| **TC-4.1.2** | Запрос при удаленной модели из `models/` | Сообщение: "Модель поиска не загружена...". Лог ошибки. | Critical | Manual | Plan |
| **TC-4.1.3** | Запрос при удаленном кэше `knowledge_cache.json` | Сообщение: "База знаний не индексирована...". Лог ошибки. | Critical | Manual | Plan |

### 4.2 Команды

| ID | Команда | Ожидаемый результат | Приоритет | Тип | Источник |
|---|---|---|---|---|---|
| **TC-4.2.1** | `/help` | Выводится справка по командам. | High | Auto | Plan |
| **TC-4.2.2** | `/start` | Приветственное сообщение. | Medium | Auto | - |
| **TC-4.2.3** | Текст начинающийся с `/` но не команда (напр. `/как настроить`) | Обрабатывается как поисковый запрос "как настроить". | Medium | Auto | Plan |

---

## Раздел 5: Сценарии из реальной жизни (User Stories)

Сценарии, основанные на частотных проблемах пользователей из логов чата.

| ID | Сценарий | Запрос | Ожидаемый результат |
|---|---|---|---|
| **TC-5.1** | **Проблема с токеном** | `токен перестал работать после обновления` | Раздел про обновление токена или Troubleshooting. |
| **TC-5.2** | **Смена пароля** | `где можно поменять пароль от домена test.vtb.ru?` | Раздел про смену паролей (6.1, 6.2). |
| **TC-5.3** | **Проблема с сертификатами** | `нужно все сертификаты автоматически обновить` | Раздел 3.4 или инструкция по сертификатам. |
| **TC-5.4** | **Блокировка** | `учетка заблочена` | Раздел про блокировки и разблокировку (2.1, 6.2). |
| **TC-5.5** | **Доступ к ресурсам** | `не могу в джире авторизоваться` | Разделы про доступы к ресурсам (Confluence/Jira) или VPN. |
| **TC-5.6** | **Проблемы с подключением** | `Сакура ругается` | Раздел 2.1 (Обязательное ПО) или Troubleshooting. |
| **TC-5.7** | **Забытый PIN** | `забыл пин код токена` | Раздел 3.1 (Первоначальная настройка) или 9. Поддержка. |

---

## Инструкция по автоматизации

Для автоматизированного тестирования (`src/tests/test_search.py`):
1. Использовать `src.search.search()` напрямую для проверки релевантности (Section 1, 2).
2. Проверять наличие ключевых фраз из "Ожидаемого результата" в возвращенном тексте.
3. Проверять `score` > порогового значения (0.25).
4. Для тестов форматирования (Section 3) использовать моки Telegram-сообщений.

## Инструкция по ручному тестированию

1. Убедиться, что бот запущен и база знаний актуальна.
2. Отправлять запросы в чат с ботом.
3. Сравнивать ответ бота с "Ожидаемым результатом".
4. Фиксировать баги в трекере задач.
